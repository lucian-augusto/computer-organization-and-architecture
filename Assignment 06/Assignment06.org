#+TITLE: Arquitetura e Organização de Computadores - Lista de Exercícios 6
#+AUTHOR: Lucian Augusto
#+STARTUP: showeverything
#+OPTIONS: date:nill toc:nil num:1
#+LATEX_HEADER: \usepackage[a4paper,left=25mm,right=25mm,top=25mm,bottom=25mm]{geometry}
#+LATEX_HEADER: \usepackage{xcolor}
#+LATEX_HEADER: \usepackage{enumitem}

* Exercício 51 - Refazer o exercício 50 da lista considerando as seguintes alterações:
- todas as instruções utilizam o estágio MEM
- se acessa a memória efetivamente -> 2 ciclos para MEM, com conflito com IF
- se não acessa -> 1 ciclo para MEM, sem conflito com IF

Condições iniciais:

R2 -> valor 1000, no endereço 1000 da memória está contido o número 3

R3 -> valor 1004, no endereço 1004 da memória está contido o número 2

Código assembly proposto:
#+begin_export latex
{\scriptsize
#+end_export

#+BEGIN_SRC asm
        LD R0, [R2], 4
        LD R1, [R3], 4
        MOV R5, R0
        SUB R5, R1
        BZ processa
        BMZ processa
        SUB R5, R5
        BZ fim
processa:
        SUB R0, R1
        MOV R5, R0
        SUB R5, R1
        BZ resultado
        BMZ processa
        SUB R5, R5
        BZ fim
resultado:
        MOV R0, 0
fim:
#+END_SRC
#+begin_export latex
}
#+end_export

** Resposta:

Montando a tabela de pipeline:

#+begin_export latex
{\scriptsize
#+end_export
#+ATTR_LATEX: :align |l|c|c|c|c|c|c|c|c|c|c|
|---------------------------+------+------+------+------------------------------+------------------------------+------------------------------+------------------------------+-------+------------------------------+------------------------------|
| $\textbf{Instrução}$      | $1$  | $2$  | $3$  | $4$                          | $5$                          | $6$                          | $7$                          | $8$   | $9$                          | $10$                         |
|---------------------------+------+------+------+------------------------------+------------------------------+------------------------------+------------------------------+-------+------------------------------+------------------------------|
| $\textbf{LD R0, [R2], 4}$ | $IF$ | $ID$ | $EX$ | $\textcolor{red}{MEM}$       | $\textcolor{red}{MEM}$       | $WB$                         |                              |       |                              |                              |
|---------------------------+------+------+------+------------------------------+------------------------------+------------------------------+------------------------------+-------+------------------------------+------------------------------|
| $\textbf{LD R1, [R3], 4}$ |      | $IF$ | $ID$ | $EX$                         | $\textcolor{red}{Bolha_{1}}$ | $\textcolor{red}{MEM}$       | $\textcolor{red}{MEM}$       | $WB$  |                              |                              |
|---------------------------+------+------+------+------------------------------+------------------------------+------------------------------+------------------------------+-------+------------------------------+------------------------------|
| $\textbf{MOV R5, R0}$     |      |      | $IF$ | $\textcolor{red}{Bolha_{2}}$ | $\textcolor{red}{Bolha_{2}}$ | $ID$                         | $EX$                         | $MEM$ | $WB$                         |                              |
|---------------------------+------+------+------+------------------------------+------------------------------+------------------------------+------------------------------+-------+------------------------------+------------------------------|
| $\textbf{SUB R5, R1}$     |      |      |      | $\textcolor{red}{Bolha_{3}}$ | $\textcolor{red}{Bolha_{3}}$ | $\textcolor{red}{Bolha_{3}}$ | $\textcolor{red}{Bolha_{3}}$ | $IF$  | $ID$                         | $EX$                         |
|---------------------------+------+------+------+------------------------------+------------------------------+------------------------------+------------------------------+-------+------------------------------+------------------------------|
| $\textbf{BZ processa}$    |      |      |      |                              |                              |                              |                              |       | $IF$                         | $ID$                         |
|---------------------------+------+------+------+------------------------------+------------------------------+------------------------------+------------------------------+-------+------------------------------+------------------------------|
| $\textbf{BMZ processa}$   |      |      |      |                              |                              |                              |                              |       | $\textcolor{red}{Bolha_{4}}$ | $\textcolor{red}{Bolha_{4}}$ |
|---------------------------+------+------+------+------------------------------+------------------------------+------------------------------+------------------------------+-------+------------------------------+------------------------------|
#+begin_export latex
}
#+end_export

Continuando a tabela:

#+begin_export latex
{\scriptsize
#+end_export
#+ATTR_LATEX: :align |l|c|c|c|c|c|c|c|c|c|c|
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{Instrução}$    | $11$                         | $12$  | $13$ | $14$ | $15$  | $16$  | $17$                         | $18$                         | $19$  | $20$                         |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{SUB R5, R1}$   | $MEM$                        | $WB$  |      |      |       |       |                              |                              |       |                              |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{BZ processa}$  | $EX$                         | $MEM$ | $WB$ |      |       |       |                              |                              |       |                              |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{BMZ processa}$ | $\textcolor{red}{Bolha_{4}}$ | $IF$  | $ID$ | $EX$ | $MEM$ | $WB$  |                              |                              |       |                              |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{SUB R0, R1}$   |                              |       | $IF$ | $ID$ | $EX$  | $MEM$ | $WB$                         |                              |       |                              |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{MOV R5, R0}$   |                              |       |      | $IF$ | $ID$  | $EX$  | $MEM$                        | $WB$                         |       |                              |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{SUB R5, R1}$   |                              |       |      |      | $IF$  | $ID$  | $EX$                         | $MEM$                        | $WB$  |                              |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{BZ resultado}$ |                              |       |      |      |       | $IF$  | $ID$                         | $EX$                         | $MEM$ | $WB$                         |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{BMZ processa}$ |                              |       |      |      |       |       | $\textcolor{red}{Bolha_{5}}$ | $\textcolor{red}{Bolha_{5}}$ | $IF$  | $ID$                         |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
| $\textbf{SUB R5, R5}$   |                              |       |      |      |       |       |                              |                              |       | $\textcolor{red}{Bolha_{6}}$ |
|-------------------------+------------------------------+-------+------+------+-------+-------+------------------------------+------------------------------+-------+------------------------------|
#+begin_export latex
}
#+end_export

Continuando a tabela:

#+begin_export latex
{\scriptsize
#+end_export
#+ATTR_LATEX: :align |l|c|c|c|c|c|c|c|c|c|c|
|-------------------------+------------------------------+-------+------+------+-------+-------+------+------+------+------|
| $\textbf{Instrução}$    | $21$                         | $22$  | $23$ | $24$ | $25$  | $26$  | $27$ | $28$ | $29$ | $30$ |
|-------------------------+------------------------------+-------+------+------+-------+-------+------+------+------+------|
| $\textbf{BMZ processa}$ | $EX$                         | $MEM$ | $WB$ |      |       |       |      |      |      |      |
|-------------------------+------------------------------+-------+------+------+-------+-------+------+------+------+------|
| $\textbf{SUB R5, R5}$   | $\textcolor{red}{Bolha_{6}}$ | $IF$  | $ID$ | $EX$ | $MEM$ | $WB$  |      |      |      |      |
|-------------------------+------------------------------+-------+------+------+-------+-------+------+------+------+------|
| $\textbf{BZ fim}$       |                              |       | $IF$ | $ID$ | $EX$  | $MEM$ | $WB$ |      |      |      |
|-------------------------+------------------------------+-------+------+------+-------+-------+------+------+------+------|
#+begin_export latex
}
#+end_export
Obs.: $\textcolor{red}{MEM}$ significa que o está efetivamente ocorrendo uma operação na memória.

Bolhas:

- $\textbf{1.}$ A primeira bolha ocorre devido a já existir uma instrução utilizando o estágio MEM;
- $\textbf{2.}$ Ocorre devido ao fato da instrução perceisar do valor que está sendo recuperado da memória (seguindo sétima a característica da arquitetura - apresentada no exercício 50);
- $\textbf{3.}$ Ocorre devido ao conflito entre estágios IF e MEM em caso de acesso de memória em MEM;
- $\textbf{4.}$ Ocorre devido à necessidade de aguardar o resultado do instrução que define o caminho um branch;
- $\textbf{5.}$ Análogo ao $\textbf{4.}$;
- $\textbf{6.}$ Análogo ao $\textbf{4.}$ e $\textbf{5.}$;

Tabela de valores dos registradores:

#+begin_export latex
{\scriptsize
#+end_export
#+ATTR_LATEX: :align |l|c|c|c|c|c|c|c|c|c|c|
|------------------------+------+------+------+------+-----------+-----------+------+------------+-----------------|
| $\textbf{Registrador}$ | $1$  |  $2$ |  $3$ |  $4$ |       $5$ |       $6$ |  $7$ |        $8$ |             $9$ |
|------------------------+------+------+------+------+-----------+-----------+------+------------+-----------------|
| $\textbf{R0}$          | X    |    3 |    3 |    3 |         3 | 3 - 2 = 1 |    1 |          1 |               1 |
|------------------------+------+------+------+------+-----------+-----------+------+------------+-----------------|
| $\textbf{R1}$          | X    |    X |    2 |    2 |         2 |         2 |    2 |          2 |               2 |
|------------------------+------+------+------+------+-----------+-----------+------+------------+-----------------|
| $\textbf{R2}$          | 1000 | 1000 | 1000 | 1000 |      1000 |      1000 | 1000 |       1000 |            1000 |
|------------------------+------+------+------+------+-----------+-----------+------+------------+-----------------|
| $\textbf{R3}$          | 1004 | 1004 | 1004 | 1004 |      1004 |      1004 | 1004 |       1004 |            1004 |
|------------------------+------+------+------+------+-----------+-----------+------+------------+-----------------|
| $\textbf{R5}$          | X    |    X |    X |    3 | 3 - 2 = 1 |         1 |    1 | 1 - 2 = -1 | (-1) - (-1) = 0 |
|------------------------+------+------+------+------+-----------+-----------+------+------------+-----------------|
#+begin_export latex
}
#+end_export
